/**
 * Created by kevin on 7/7/15.
 */

import Initializer from "application/Initializer";
import Server from "express/Server";

import BodyParser from "express/middlewares/BodyParser";
import FiberDecorator from "express/middlewares/FiberDecorator";
import ErrorHandler from "express/middlewares/ErrorHandler";
import ApiRouter from "express/middlewares/ApiRouter";
import PingRouting from "express/routes/public/PingRouting";
import PlanCaseRouting from "express/routes/public/PlanCaseRouting";
import UserNotificationRouting from "express/routes/public/UserNotificationRouting";
import StaticFolder from "express/middlewares/StaticFolder";
import {MakeUtil} from "framework/Util";

Initializer.make().init()
    .then(() => {
        const apiFolder = "/api";
        const server = new Server([
            new BodyParser,
            new FiberDecorator,
            new ApiRouter({folder: apiFolder, routing: new PingRouting}),
            new ApiRouter({folder: apiFolder, routing: new PlanCaseRouting}),
            new ApiRouter({folder: apiFolder, routing: new UserNotificationRouting}),
            new StaticFolder({folder: "/public/", path: MakeUtil().uploadDirectory}),
            new StaticFolder({folder: "/tmp/", path: MakeUtil().tmpDirectory}),
            // Error Handler
            new ErrorHandler,
        ]);
        server.listen(3333);
    });
