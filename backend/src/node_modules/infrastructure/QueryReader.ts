/**
 * Created by x on 30/08/16.
 */

import WaitForPromise from "infrastructure/WaitForPromise";
import SequelizeConnection from "infrastructure/SequelizeConnection";


export class QueryReader<T> {

    private queryBuilder: any;
    private wait: <T>(arg: Promise<T>) => T;

    constructor(queryBuilder: any, wait?: <T>(arg: Promise<T>) => T) {
        this.queryBuilder = queryBuilder;
        this.wait = wait || WaitForPromise;
    }

    public query(): T[] {
        return this._exec(this.queryBuilder.toString());
    }

    private _exec(query: string): T[] {
        return this.wait(SequelizeConnection.connection.query(query,
            {
                type: SequelizeConnection.connection.QueryTypes.SELECT,
            }
        ));
    }

}

